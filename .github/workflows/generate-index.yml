name: Generate Folder Indexes

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-index:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Generate index.md for every folder
        shell: bash
        run: |
          echo "Scanning folders..."

          # Loop through all directories (ignore .github and .git)
          find . -type d ! -path "./.git*" ! -path "./.github*" | while read -r dir; do
            
            index="$dir/index.md"
            readme="$dir/README.md"

            # Skip root folder (we don't need index.md here)
            if [[ "$dir" == "." ]]; then
              continue
            fi

            echo "Generating $index"

            echo "<div style='padding: 10px; background: #f2f2f2; border-radius: 8px; margin-bottom: 20px;'>
  <strong>Navigation:</strong>" > "$index"

            # Build nav: list all top-level folders
            for folder in */ ; do
              clean="${folder%/}"
              echo "  <a href='/$clean/' style='margin-right: 15px;'>$clean</a>" >> "$index"
            done

            echo "</div>" >> "$index"
            echo "" >> "$index"

            # If folder has a README.md, include it
            if [[ -f "$readme" ]]; then
              echo "{% include_relative README.md %}" >> "$index"
            else
              echo "_No README.md found for this section._" >> "$index"
            fi

          done

      - name: Commit changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Auto-generated index.md files"
